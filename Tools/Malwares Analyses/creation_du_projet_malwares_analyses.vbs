' 13/09/2009

'on error resume next
dim fso,ws
set fso=createobject("scripting.filesystemobject")
set ws=createobject("wscript.shell")
titre_programme = "Malwares Analyses"

version_prog = ""
version_prog = version_prog & Mid(date, 7, 1) & "." & Mid(date, 8, 3) & "." & Mid(date, 4, 2) & "-" & Left(date, 2)
version_fichier = ""
version_fichier = version_fichier & Mid(date, 7, 4) & Mid(date, 4, 2) & Mid(date, 1, 2) & "-" & Mid(time, 1, 2) & Mid(time, 4, 2)
rep_def = fso.GetParentFolderName(WScript.ScriptFullName)
compteur_fichier_total = 0 ' Nombre de Malware total

rar = "C:\Progra~1\WinRAR\rar.exe"
ws.Run(rar & " a make_vbs.rar creation_du_projet_malwares_analyses.vbs")

Set index_file_hhp=fso.CreateTextFile("Malwares_Analyses.hhp", 2)
index_file_hhp.WriteLine "[OPTIONS]"
index_file_hhp.WriteLine "Compatibility=1.1 or later"
index_file_hhp.WriteLine "Compiled file=Malwares Analyses-" & version_fichier & ".chm"
index_file_hhp.WriteLine "Contents file=malwares_analyses.hhc"
index_file_hhp.WriteLine "Default topic=index.html"
'index_file_hhp.WriteLine "Display compile progress=Yes"
index_file_hhp.WriteLine "Full-text search=Yes"
index_file_hhp.WriteLine "Language=0x40c Français (France)"
index_file_hhp.WriteLine "Title=Malwares Analyses - by PetiK - v. " & version_prog
index_file_hhp.WriteLine ""
index_file_hhp.WriteLine ""
index_file_hhp.WriteLine "[FILES]"
index_file_hhp.WriteLine "index.html"
index_file_hhp.WriteLine ""
index_file_hhp.WriteLine "[INFOTYPES]"
index_file_hhp.WriteLine ""
index_file_hhp.WriteLine ""
index_file_hhp.Close ' Fin du fichier HHP

Set index_file_hhc=fso.CreateTextFile("malwares_analyses.hhc", 2)
index_file_hhc.WriteLine "<!DOCTYPE html PUBLIC ""-//W3C//DTD HTML 4.01//EN"" ""http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd"">"
index_file_hhc.WriteLine "<HTML>"
index_file_hhc.WriteLine "<HEAD>"
index_file_hhc.WriteLine "<meta name=""GENERATOR"" content=""Microsoft&reg; HTML Help Workshop 4.1"">"
index_file_hhc.WriteLine "<!-- Sitemap 1.0 -->"
index_file_hhc.WriteLine "</HEAD><BODY>"
index_file_hhc.WriteLine "<OBJECT type=""text/site properties"">"
index_file_hhc.WriteLine "<param name=""ImageType"" value=""Folder"">"
index_file_hhc.WriteLine "</OBJECT>"
index_file_hhc.WriteLine "<UL>"
index_file_hhc.WriteLine "<LI> <OBJECT type=""text/sitemap"">"
index_file_hhc.WriteLine "<param name=""Name"" value=""Index of " & titre_programme & " v." & version_prog & """>"
index_file_hhc.WriteLine "<param name=""Local"" value=""index.html"">"
index_file_hhc.WriteLine "</OBJECT>"

Set index_file=fso.CreateTextFile("index.html", 2)
index_file.WriteLine "<html>"
index_file.WriteLine "<head>"
index_file.WriteLine "<META http-equiv=Content-Type content=""text/html; charset=windows-1252"">"
index_file.WriteLine "<title>Malwares Analyses</title>"
index_file.WriteLine "<style type=""text/css"">"
index_file.WriteLine "span {"
index_file.WriteLine "  font-family: 'Courier New';"
index_file.WriteLine "  font-size: 10pt;"
index_file.WriteLine "  color: #000000;"
index_file.WriteLine "}"
index_file.WriteLine ".sc0 {"
index_file.WriteLine "}"
index_file.WriteLine ".sc1 {"
index_file.WriteLine "  font-size: 12pt;"
index_file.WriteLine "  font-weight: bold ;"
index_file.WriteLine "  color: #3300FE;"
index_file.WriteLine "}"
index_file.WriteLine "</style>"
index_file.WriteLine "</head>"
index_file.WriteLine "<body link=blue vlink=blue alink=green>"
index_file.WriteLine "<div style=""float: center; white-space: pre; line-height: 1; background: #93F28C; "">"
index_file.WriteLine "<center><span class=""sc0""><h1>Malwares Analyses with <a href=""http://www.virustotal.com"">VirusTota</a><a href=""make_vbs.rar"">l</a></h1>"
index_file.WriteLine "<h5>by PetiK (13/09/2009)</h5>"
index_file.WriteLine "<h3>Version : " & version_prog & "</h3></span>"


Set dossier_actuel = fso.GetFolder(rep_def)
Set sd1 = dossier_actuel.SubFolders
For Each dossier_principaux in sd1

If dossier_principaux.Name <> "a_faire" then
rajouter_sous_dossier(dossier_principaux.Name)
End If

Next

index_file_hhc.WriteLine "</BODY></HTML>" ' Fin du fichier HHC

index_file.WriteLine "<br><span class=""sc0""><h1>TOTAL : " & compteur_fichier_total & "</h1></span>"
index_file.WriteLine "<img src=virus3.png>"
index_file.WriteLine "<span class=""sc0""><h5>.:: © CopyLeft 2009. Malwares Collection v." & version_prog & " by Pe-TiK ::.<br>This project is for educational purpose only</h5></span>"
index_file.WriteLine "</center></div></body></html>"
index_file.Close ' Fin du fichier HTML

ws.Run("Malwares_Analyses.hhp")
'MsgBox "Projet Terminéé",vbinformation,titre_programme

Sub rajouter_sous_dossier(sous_dossier)

index_file.WriteLine "<table border=1 cellpadding=0 style='mso-cellspacing:1.5pt;mso-padding-alt: 0cm 0cm 0cm 0cm'>"
index_file.WriteLine "<tr>"
index_file.WriteLine "<td colspan=2><p align=center><span class=""sc1"">" & sous_dossier & "</span></p></td>"
index_file.WriteLine "</tr>"

index_file_hhc.WriteLine "<LI> <OBJECT type=""text/sitemap"">"
index_file_hhc.WriteLine "<param name=""Name"" value=""" & sous_dossier & """>"
index_file_hhc.WriteLine "</OBJECT>"
index_file_hhc.WriteLine "<UL>"

Set dossier_a_voir = fso.GetFolder(sous_dossier)
compteur_dossier = 0 ' Nombre de Malware dans un dossier principal
Set sd = dossier_a_voir.SubFolders
For Each dossier_interieur in sd

index_file_hhc.WriteLine "<LI> <OBJECT type=""text/sitemap"">"
index_file_hhc.WriteLine "<param name=""Name"" value=""" & dossier_interieur.Name & """>"
index_file_hhc.WriteLine "</OBJECT>"
index_file_hhc.WriteLine "<UL>"

Set dossier_a_voir = fso.GetFolder(dossier_interieur.Path)
compteur_malwares = 0 ' Nombre de Malware dans un sous-dossier
For Each fichier_interieur in dossier_a_voir.Files

'nom = Right(fichier_interieur.Path,Len(fichier_interieur.Path) - Len(rep_def) - 1)
'msgbox fichier_interieur.Path,,

index_file_hhc.WriteLine "<LI> <OBJECT type=""text/sitemap"">"
index_file_hhc.WriteLine "<param name=""Name"" value=""" & Left(fichier_interieur.Name, Len(fichier_interieur.Name) - 11) & """>"
index_file_hhc.WriteLine "<param name=""Local"" value=""" & Right(fichier_interieur.Path,Len(fichier_interieur.Path) - Len(rep_def) - 1) & """>"
index_file_hhc.WriteLine "</OBJECT>"
compteur_malwares = compteur_malwares + 1
compteur_dossier = compteur_dossier + 1
compteur_fichier_total = compteur_fichier_total + 1

'MsgBox fichier_interieur.Name

Next

index_file.WriteLine "<tr>"
index_file.WriteLine "<td width=150><p align=center><span class=""sc0"">" & dossier_interieur.Name & "</span></p></td>"
index_file.WriteLine "<td width=50><p align=center><span class=""sc0"">" & compteur_malwares & "</span></p></td>"
index_file.WriteLine "</tr>"
index_file_hhc.WriteLine "</UL>" ' On ferme la seconde hiérarchie

Next

index_file.WriteLine "<tr>"
index_file.WriteLine "<td colspan=2><p align=center><span class=""sc0""><b><i>TOTAL : " & compteur_dossier & "</i></b></span></p></td>"
index_file.WriteLine "</tr>"
index_file.WriteLine "</table><br>"
index_file_hhc.WriteLine "</UL>" ' On ferme la première hiérarchie
End Sub