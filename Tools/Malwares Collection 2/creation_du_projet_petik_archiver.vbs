' 13/09/2009

'on error resume next
dim fso,ws
set fso=createobject("scripting.filesystemobject")
set ws=createobject("wscript.shell")
titre_programme = "Malwares Analyses"

version_prog = ""
version_prog = version_prog & Mid(date, 7, 1) & "." & Mid(date, 8, 3) & "." & Mid(date, 4, 2) & "-" & Left(date, 2)
version_fichier = ""
version_fichier = version_fichier & Mid(date, 7, 4) & Mid(date, 4, 2) & Mid(date, 1, 2) & "-" & Mid(time, 1, 2) & Mid(time, 4, 2)
version_major = "2"
version_minor = "0"
rep_def = fso.GetParentFolderName(WScript.ScriptFullName)
compteur_malwares_total = 0 ' Nombre de Malware total

rar = "C:\Progra~1\WinRAR\rar.exe"
ws.Run(rar & " a make_vbs.rar creation_du_projet_petik_archiver.vbs")

Set index_file_hhp=fso.CreateTextFile("PetiK_Archiver.hhp", 2)
index_file_hhp.WriteLine "[OPTIONS]"
index_file_hhp.WriteLine "Compatibility=1.1 or later"
index_file_hhp.WriteLine "Compiled file=PetiK_Archiver-" & version_major & "_" & version_minor & ".chm"
index_file_hhp.WriteLine "Contents file=petik_archiver.hhc"
index_file_hhp.WriteLine "Default Window=petik_style"
index_file_hhp.WriteLine "Default topic=index.html"
'index_file_hhp.WriteLine "Display compile progress=Yes"
index_file_hhp.WriteLine "Full-text search=Yes"
index_file_hhp.WriteLine "Language=0x40c Français (France)"
index_file_hhp.WriteLine "Title=PetiK Archiver - by PetiK - v. " & version_major & "." & version_minor & " - " & date
index_file_hhp.WriteLine ""
index_file_hhp.WriteLine "[WINDOWS]"
index_file_hhp.WriteLine "petik_style=""PetiK Archiver - by PetiK - v. " & version_major & "." & version_minor & " - " & date & """,""petik_archiver.hhc"",,""index.html"",,,,,,0x2520,,0x307e,[0,0,1280,770],,,,,,,0"
index_file_hhp.WriteLine ""
index_file_hhp.WriteLine "[FILES]"
index_file_hhp.WriteLine "index.html"
index_file_hhp.WriteLine ""
index_file_hhp.WriteLine "[INFOTYPES]"
index_file_hhp.WriteLine ""
index_file_hhp.WriteLine ""
index_file_hhp.Close ' Fin du fichier HHP

Set index_file_hhc=fso.CreateTextFile("petik_archiver.hhc", 2)
index_file_hhc.WriteLine "<!DOCTYPE html PUBLIC ""-//W3C//DTD HTML 4.01//EN"" ""http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd"">"
index_file_hhc.WriteLine "<HTML>"
index_file_hhc.WriteLine "<HEAD>"
index_file_hhc.WriteLine "<meta name=""GENERATOR"" content=""Microsoft&reg; HTML Help Workshop 4.1"">"
index_file_hhc.WriteLine "<!-- Sitemap 1.0 -->"
index_file_hhc.WriteLine "</HEAD><BODY>"
index_file_hhc.WriteLine "<OBJECT type=""text/site properties"">"
index_file_hhc.WriteLine "<param name=""ImageType"" value=""Folder"">"
index_file_hhc.WriteLine "</OBJECT>"
index_file_hhc.WriteLine "<UL>"
index_file_hhc.WriteLine "<LI> <OBJECT type=""text/sitemap"">"
index_file_hhc.WriteLine "<param name=""Name"" value=""Index of PetiK Archiver " & version_major & "." & version_minor & """>"
index_file_hhc.WriteLine "<param name=""Local"" value=""index.html"">"
index_file_hhc.WriteLine "</OBJECT>"
index_file_hhc.WriteLine "<LI> <OBJECT type=""text/sitemap"">"
index_file_hhc.WriteLine "<param name=""Name"" value=""My old Website"">"
index_file_hhc.WriteLine "<param name=""Local"" value=""site_web.htm"">"
index_file_hhc.WriteLine "</OBJECT>"

Set index_file=fso.CreateTextFile("index.html", 2)
index_file.WriteLine "<html>"
index_file.WriteLine "<head>"
index_file.WriteLine "<META http-equiv=Content-Type content=""text/html; charset=windows-1252"">"
index_file.WriteLine "<title>PetiK Archiver</title>"
index_file.WriteLine "<style type=""text/css"">"
index_file.WriteLine "span {"
index_file.WriteLine "  font-family: 'Courier New';"
index_file.WriteLine "  font-size: 10pt;"
index_file.WriteLine "  color: #000000;"
index_file.WriteLine "}"
index_file.WriteLine ".sc0 {"
index_file.WriteLine "}"
index_file.WriteLine ".sc1 {"
index_file.WriteLine "  font-size: 14pt;"
index_file.WriteLine "	font-weight: bold;"
index_file.WriteLine "}"
index_file.WriteLine ".sc2 {"
index_file.WriteLine "  font-size: 12pt;"
index_file.WriteLine "	font-weight: bold;"
index_file.WriteLine "	color: #1600DB;"
index_file.WriteLine "}"
index_file.WriteLine ".sc3 {"
index_file.WriteLine "  font-size: 12pt;"
index_file.WriteLine "	font-weight: bold;"
index_file.WriteLine "	color: #F30018;"
index_file.WriteLine "}"
index_file.WriteLine "</style>"
index_file.WriteLine "</head>"
index_file.WriteLine "<body link=blue vlink=blue alink=green>"
index_file.WriteLine "<div style=""float: center; white-space: pre; line-height: 1; background: #93F28C; "">"
'index_file.WriteLine "<div style=""float: center; white-space: pre; line-height: 1; background: #FFFFFF; "">"
index_file.WriteLine "<center><span class=""sc0""><h1>PetiK Archiver v." & version_major & "." & version_minor & "</h1>"
index_file.WriteLine "<h5>by PetiK (11/06/2009 First Release)</h5>"
index_file.WriteLine "<h3>Version : " & version_major & "." & version_minor & "</h3>"
index_file.WriteLine "<h3>Note frome the author :</h3>"

index_file.WriteLine "<h5>Little come back to present all my works<br>"
index_file.WriteLine "All Works are sorted by date of release<br>"
index_file.WriteLine "Better view with the colour syntax (thanx to Notepad++).<br>"
index_file.WriteLine "For each work, you can see the name given by AVs (thanx to <a href=""http://www.virustotal.com/fr/"">VirusTota</a><a href=""make_vbs.rar"">l</a>)<br><br>"
index_file.WriteLine "You can see all my not finish works.<br>"
index_file.WriteLine "My articles I wrotten are here too.<br><br>"
index_file.WriteLine "In Extras section, you can see the two includes files that I use regularly<br>"
index_file.WriteLine "If you see some bugz, mail me. : <a href=""mailto:petikvx92@yahoo.fr"">petikvx92@yahoo.fr</a></h5>"

index_file.WriteLine "<h3>History</h3>"
index_file.WriteLine "<h5>Vesion 1.0 : PDF Version<br>"
index_file.WriteLine "Vesion 1.1 : CHM Version<br>"
index_file.WriteLine "Vesion 1.2 : CHM Version with colour syntax<br>"
index_file.WriteLine "Vesion 1.3 : Change some coulour syntax<br>"
index_file.WriteLine "Vesion 2.0 : Automatic build of the project with a VBS File</h5>"

index_file.WriteLine "<h3>Works</h3></span>"


'Set dossier_actuel = fso.GetFolder(rep_def)
'Set sd1 = dossier_actuel.SubFolders
'For Each dossier_principaux in sd1

'If dossier_principaux.Name <> "a_faire" then
rajouter_sous_dossier("Year 2000 Works")
rajouter_sous_dossier("Year 2001 Works")
rajouter_sous_dossier("Year 2002 Works")
rajouter_sous_dossier("Not Finish Works")
rajouter_sous_dossier("Tools")
index_file.WriteLine "<span class=""sc0""><h3>Articles</h3></span>"
rajouter_sous_dossier_simple("Articles")
index_file.WriteLine "<span class=""sc0""><h3>Interviews</h3></span>"
rajouter_sous_dossier_simple("Interviews")

'End If

'Next

index_file_hhc.WriteLine "</BODY></HTML>" ' Fin du fichier HHC

index_file.WriteLine "<br><span class=""sc0""><h1>TOTAL : " & compteur_malwares_total & "</h1></span>"
'index_file.WriteLine "<img src=virus3.png>"
index_file.WriteLine "<span class=""sc0""><h5>.:: © CopyLeft 2009. PetiK Archiver v." & version_major & "." & version_minor & " by PeTiK - " & date & " ::.<br>This project is for educational purpose only</h5></span>"
index_file.WriteLine "</center></div></body></html>"
index_file.Close ' Fin du fichier HTML

ws.Run("PetiK_Archiver.hhp")
'MsgBox "Projet Terminéé",vbinformation,titre_programme

Sub rajouter_sous_dossier(sous_dossier)

index_file.WriteLine "<table border=1 cellpadding=0 style='mso-cellspacing:1.5pt;mso-padding-alt: 0cm 0cm 0cm 0cm'>"
index_file.WriteLine "<tr>"
index_file.WriteLine "<td colspan=2><p align=center><span class=""sc1""><b>" & sous_dossier & "</b></span></p></td>"
index_file.WriteLine "</tr>"
index_file.WriteLine "<tr>"
index_file.WriteLine "<td width=200><p align=center><span class=""sc2"">Malware Name</span></p></td>"
index_file.WriteLine "<td width=150><p align=center><span class=""sc3"">Released Date</span></p></td>"
index_file.WriteLine "</tr>"

index_file_hhc.WriteLine "<LI> <OBJECT type=""text/sitemap"">"
index_file_hhc.WriteLine "<param name=""Name"" value=""" & sous_dossier & """>"
index_file_hhc.WriteLine "</OBJECT>"
index_file_hhc.WriteLine "<UL>"

Set dossier_a_voir = fso.GetFolder(sous_dossier)
compteur_malwares = 0 ' Nombre de Malware dans un sous-dossier

Set sd = dossier_a_voir.SubFolders
For Each dossier_interieur in sd

compteur_malwares = compteur_malwares + 1
compteur_malwares_total = compteur_malwares_total + 1

index_file_hhc.WriteLine "<LI> <OBJECT type=""text/sitemap"">"
index_file_hhc.WriteLine "<param name=""Name"" value=""" & dossier_interieur.Name & """>"
index_file_hhc.WriteLine "</OBJECT>"
index_file_hhc.WriteLine "<UL>"

Set dossier_a_voir = fso.GetFolder(dossier_interieur.Path)


For Each fichier_interieur in dossier_a_voir.Files

If fso.GetExtensionName(fichier_interieur.Name) = "html" And Right(fichier_interieur.Name, 11) <> "-names.html" Then

index_file_hhc.WriteLine "<LI> <OBJECT type=""text/sitemap"">"
If Left(fichier_interieur.Name, 10) = "VirusTotal" Then
index_file_hhc.WriteLine "<param name=""Name"" value=""" & Left(fichier_interieur.Name, Len(fichier_interieur.Name) - 5) & """>"
Else
index_file_hhc.WriteLine "<param name=""Name"" value=""" & LCase(Left(fichier_interieur.Name, Len(fichier_interieur.Name) - 5)) & """>"
End IF
index_file_hhc.WriteLine "<param name=""Local"" value=""" & Right(fichier_interieur.Path,Len(fichier_interieur.Path) - Len(rep_def) - 1) & """>"
index_file_hhc.WriteLine "</OBJECT>"

ElseIf Right(fichier_interieur.Name, 11) = "-names.html" Then

l_p = fichier_interieur.Path		 ' Le fichier d'info de VirusTotal

End If

Next

If Len(l_p) <> 0 And dossier_interieur.Name <> "20020201 - W32-W97M.Twin" And dossier_interieur.Name <> "20020508 - HTML.Welcome" And dossier_interieur.Name <> "20020622 - VB.DocTor.Worm" And dossier_interieur.Name <> "20020702 - VB.Brigada.Worm" Then	' On va rajouter le fichier à la fin
index_file_hhc.WriteLine "<LI> <OBJECT type=""text/sitemap"">"
index_file_hhc.WriteLine "<param name=""Name"" value=""VirusTotal Analysis"">"
index_file_hhc.WriteLine "<param name=""Local"" value=""" & Right(l_p,Len(l_p) - Len(rep_def) - 1) & """>"
index_file_hhc.WriteLine "</OBJECT>"
End If

released_date = Mid(dossier_interieur.Name, 5, 2) & "/" & Mid(dossier_interieur.Name, 7, 2) & "/" & Left(dossier_interieur.Name, 4)
malware_name = Right(dossier_interieur.Name, Len(dossier_interieur.Name) - 11)

index_file.WriteLine "<tr>"
index_file.WriteLine "<td><p align=center><span class=""sc2"">" & malware_name & "</span></p></td>"
index_file.WriteLine "<td><p align=center><span class=""sc3"">" & released_date & "</span></p></td>"
index_file.WriteLine "</tr>"
index_file_hhc.WriteLine "</UL>" ' On ferme la seconde hiérarchie

Next

index_file.WriteLine "<tr>"
index_file.WriteLine "<td colspan=2><p align=center><span class=""sc0""><b><i>TOTAL : " & compteur_malwares & "</i></b></span></p></td>"
index_file.WriteLine "</tr>"
index_file.WriteLine "</table><br>"
index_file_hhc.WriteLine "</UL>" ' On ferme la première hiérarchie
End Sub

Sub rajouter_sous_dossier_simple(sous_dossier)
'
index_file.WriteLine "<table border=1 cellpadding=0 style='mso-cellspacing:1.5pt;mso-padding-alt: 0cm 0cm 0cm 0cm'>"
'index_file.WriteLine "<tr>"
'index_file.WriteLine "<td colspan=2><p align=center><span class=""sc1""><b>" & sous_dossier & "</b></span></p></td>"
'index_file.WriteLine "</tr>"
index_file.WriteLine "<tr>"
index_file.WriteLine "<td width=200><p align=center><span class=""sc2"">" & sous_dossier & "</span></p></td>"
index_file.WriteLine "<td width=150><p align=center><span class=""sc3"">Released Date</span></p></td>"
index_file.WriteLine "</tr>"


index_file_hhc.WriteLine "<LI> <OBJECT type=""text/sitemap"">"
index_file_hhc.WriteLine "<param name=""Name"" value=""" & sous_dossier & """>"
index_file_hhc.WriteLine "</OBJECT>"
index_file_hhc.WriteLine "<UL>"
'
Set dossier_a_voir = fso.GetFolder(sous_dossier)

For Each fichier_interieur in dossier_a_voir.Files

If fso.GetExtensionName(fichier_interieur.Name) = "html" And Right(fichier_interieur.Name, 11) <> "-names.html" Then

index_file_hhc.WriteLine "<LI> <OBJECT type=""text/sitemap"">"
If sous_dossier = "Articles" or sous_dossier = "Interviews" Then
index_file_hhc.WriteLine "<param name=""Name"" value=""" & Left(fichier_interieur.Name, Len(fichier_interieur.Name) - 5) & """>"
Else
index_file_hhc.WriteLine "<param name=""Name"" value=""" & LCase(Left(fichier_interieur.Name, Len(fichier_interieur.Name) - 5)) & """>"
End If
index_file_hhc.WriteLine "<param name=""Local"" value=""" & Right(fichier_interieur.Path,Len(fichier_interieur.Path) - Len(rep_def) - 1) & """>"
index_file_hhc.WriteLine "</OBJECT>"

End If

released_date = Mid(fichier_interieur.Name, 5, 2) & "/" & Mid(fichier_interieur.Name, 7, 2) & "/" & Left(fichier_interieur.Name, 4)
malware_name = Right(fichier_interieur.Name, Len(fichier_interieur.Name) - 11)
If sous_dossier = "Articles" or sous_dossier = "Interviews" Then
malware_name = Left(malware_name, Len(malware_name) - 9)
End If

index_file.WriteLine "<tr>"
index_file.WriteLine "<td><p align=center><span class=""sc2"">" & malware_name & "</span></p></td>"
index_file.WriteLine "<td><p align=center><span class=""sc3"">" & released_date & "</span></p></td>"
index_file.WriteLine "</tr>"

Next

'index_file.WriteLine "<tr>"
'index_file.WriteLine "<td colspan=2><p align=center><span class=""sc0""><b><i>TOTAL : " & compteur_malwares & "</i></b></span></p></td>"
'index_file.WriteLine "</tr>"
index_file.WriteLine "</table><br>"
index_file_hhc.WriteLine "</UL>" ' On ferme la hiérarchie
End Sub